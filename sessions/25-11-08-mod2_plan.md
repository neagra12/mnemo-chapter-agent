# Mod2 plan until Break
This is the plan we developed for the next three lectures, This fits nicely with a wrappup lecture on the Wednesday before break. We can have the cycle 2 summary report due on the Friday before the break and nothing to do over the break.

Here is the decision log update summarizing our restructuring of the course's "Security" module.

---

### Decision Log: Restructuring the Security & 12-Factor Module (Lec 7-9)

- **Date:** 2025-11-08
- **Status:** Decided

---

## Context

Our original plan for Lecture 7 was to cover multiple, dense topics: the 12-Factor App, `.env` files for security, and external security threats (XSS, CSRF). This was thematically jumbled and presented a high cognitive load.

Simultaneously, we recognized an immediate, "felt" pain point for students: **developer environment inconsistency**. Team members on different operating systems or with different local setups were struggling with hand-offs, particularly around configuration (e.g., `FLASK_DEBUG` status, database file locations).

We needed to restructure Lectures 7, 8, and 9 to solve the immediate consistency problem first, which would then provide a stronger pedagogical foundation for the more abstract security concepts.

---

## Decisions

We have redesigned the "Security & Professional Practices" module to span two distinct, week-long sprints (Weeks 12 and 13).

### 1. Sprint 1: "Internal Security & AuthZ" (Week 12)

This sprint is focused entirely on building an **internal** authorization model (Role-Based Access Control, or RBAC) and solving dev environment pain.

* **Lecture 7: Admin Powers & Dev Consistency**
    * **Topic 1: `.env` for Consistency.** We will introduce the `.env` file *not* for security, but as the solution for **developer environment consistency**.
    * **"I/WE" Refactor:** We will move `FLASK_DEBUG` and the `DATABASE_URL` into a `.env` file, which will be added to `.gitignore`. This solves the team hand-off problem.
    * **Topic 2: The "Setup".** We will explicitly *leave* the hardcoded `SECRET_KEY` in `config.py` as a "code smell" and "technical debt" to be addressed later.
    * **Topic 3: Formal RBAC.** We will formally introduce the "admin" vs. "user" roles and show students how to modify the database (`flask shell`) to grant themselves admin privileges.
    * **"I/WE" Feature:** We will build an **Admin "Modify Joke"** feature, protected by an `if current_user.role != 'admin'` check.
    * **Assignment (A11):** Students will implement the **Admin "Modify User"** feature.

* **Lecture 8: Ratings & Advanced RBAC**
    * **Topic 1: Many-to-Many Relationships.** We will design and implement the "Joke Rating" feature, which requires a new `Rating` model acting as an **association table** (linking `user_id` and `joke_id`).
    * **Topic 2: Reinforcing RBAC.** We will apply our new RBAC rules to this feature (e.g., "An admin can delete any rating").
    * **Assignment (A12):** Students will refactor their duplicated `if...` checks into a custom **`@admin_required` decorator**.

### 2. Sprint 2: "External Security & 12-Factor" (Week 13)

This sprint focuses on defending against **external** threats and formalizing our professional patterns.

* **Lecture 9: External Security & The 12-Factor App**
    * **Topic 1: The "Duh!" Moment.** We will pay off our "technical debt." We'll ask, "Where should this insecure `SECRET_KEY` go?" Students, now comfortable with `.env`, will identify the correct solution.
    * **Topic 2: The "Snap-in".** We will use this refactor as the hook to formally introduce the **12-Factor App**. We will frame it as a validation, showing students how many of the factors (Dependencies, Config, Processes, etc.) they are *already* following.
    * **Topic 3: External Threats.** Now that we have an internal model to protect, we will introduce **XSS** (and Jinja2's defense) and **CSRF** (and Flask-WTF's defense).
    * **Topic 4: Security Testing.** We will show students how to write `pytest` tests that *try* to perform an XSS attack, proving that the framework's protections are working.

---

## Rationale

This new structure is far superior pedagogically for three key reasons:

1.  **Solves Immediate Pain:** It uses the `.env` file to solve a real, immediate problem (dev consistency) *before* introducing the abstract concept of secrets management.
2.  **Thematic Purity:** It creates two clean sprints. Week 12 is "Internal Security (AuthZ)," and Week 13 is "External Security & Config." This separation is logical and prevents cognitive overload.
3.  **High-Impact "Snap-in":** Introducing the 12-Factor App *after* students have already done the work validates their experience and makes the principles "stick." It's a "naming" of their good habits, not a "list" to memorize. This is a much more powerful and motivating way to teach professional standards.